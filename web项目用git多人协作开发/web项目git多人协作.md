# web 项目如何进行 git 多人协作开发

 对于大部分 web 项目而言，并不像软件、APP 项目一样有版本的划分，而是不断的更新、迭代，这就使得 web 项目的 git 使用要复杂一些，需要管理好哪些是正在开发的代码、哪些是提交测试的代码、哪些是已经上线的代码、多人共同开发时如何避免代码冲突与线上新代码被旧代码覆盖等等。

## 1. 一个分支
 如果项目比较小,不频繁更新时,可以只舍不得一个master分支

使用流程:

![单分支使用流程](https://image-static.segmentfault.com/832/673/832673556-5c666c607e489)

  1. 提交代码到本地master分支,并推送到远程master分支
  2. 持续集成构建或本地构建,然后上传到服务器

 上传到服务器有两中方式
 1. 持续集成构建,然后同步到服务器
 2. 本地构建,然后上传到服务器

## 2. 开发分支与个人分支
 如果项目稍大些,更新频繁,就需要另外一个一发我发分支:
 - master:主分支,对应线上代码
 - dev:开发分支,对应开发代码

 使用流程

 ![一个人分支开发流程](https://image-static.segmentfault.com/301/393/3013939827-5c666c6f98286)

1. 提交到代码到本地dev分支
2. 在需要构建项目时merge到本地master分支,并推送到远程master分支
3. 持续集成构建,然后同步到服务器

 如果是多人参与项目,就需要个人开发分支了
 - master:主分支,对应线上代码
 - man1:个人man1开发分支
 - man2:个人man2开发分支

  使用流程
  ![多人开发分支](https://image-static.segmentfault.com/205/515/2055159803-5c666c7e99057)

  1.提交代码到本地man1分支(以man1为例)
  2.在需要构建项目时merge到本地master分支,并推送到远程master分支
  3.持续并集成构建,然后同步到服务器

 在行当的时候,每一个个人分支都需要要pull一下merge分支,以保证自己本地代码不会你低于服务器版本

 ## 3. 多个服务器环境
  如果项目比较大,并且对应多个服务器环境(测试环境,产品环境)
  - master:主分支
  - prod:产品分支,对应产品服务器环境
  - test:测试分支,对应测试服务器
  - dev:开发分支

 使用流程
 ![多服务器环境](https://image-static.segmentfault.com/115/587/1155875304-5c666c8e0d96d)

 构建测试环境
  1. 提交你有对象到本地dev分支
  2. 在需要构建项目时merge到本地test分支,并推送到远程test分支
  3. 持续集成构建,然后同步到测试服务器

 构建产品环境可以由远程test分支merge到远程prod分支进行持续集成构建,也可由本地dev或test分支merge到本地prod分支,并推送到prod分支进行持续集成

 如果是多人对与的项目,就需要个人开发分支了
 - master:主分支
 - prod: 产品分支,对应产品服务器环境
 - test:测试分支,对应测试服务器环境
 - man1:个人man1开发分支
 - man2:个人man2开发分支

使用流程
![多人多服务器开发流程](https://image-static.segmentfault.com/219/147/2191477726-5c666ca2191fd)

 构建测试环境
 1. 提交代码到本地man1分支(以man1个人为例)
 2. 在需要构建项目时merge到本地test分支,并推送到远程test分支
 3. 持续集成构建,然后同步到测试服务器

 构建产品环境可以由远程test分支merge到远程prod分支进行持续集成构建,也可由本地man1或test分支merge到本地prod分支,并推送到prod分支进行持续集成构建

 在适当的时候:第一个个人分支都需要pull一下prod分支,以保证本地的代码版本不会低于服务器版本

## 4. 多个需求同时开发
 有时候会有多个需求同时开发,并且相互独立,为了不影响每个需求的测试与上线,需要为每个需求创建一个分支
 - master:主分支
 - prod:产品分支,对应产品服务器环境
 - test:测试分支,对应测试服务器环境
 - man1:个人man1分支
 - man2:个人man2分支
 - task1:需求task1开发分支
 - task2:需求task2开发分支

 使用流程

 ![多需求多人开发](https://image-static.segmentfault.com/281/881/2818818971-5c666cb193ff3)

 构建测试环境与之前的步骤一致,但构建产产品环境时,为了保证各个需求不相互影响,一般由本地直接合并到prod分支
 1. 本地task1分支merge到本地prod分支,并推送到远程prod分支进行持续集成构建
 2. 每一个个人分支都需要pull一下prod分支,以保证自己本地的代码的版本不会低于服务器版本
 3. 最后删除task1分支

## 5. 多人协作开发修改公共文件
 因为不同分支修改同一个文件而导致的文件冲突是多人协作中比较常见的问题之一,避免这种问题的的思路主要有以下的几种:
 1. 在代码层面尽量避免多个成员都会改动的文件,尽量奖代码分解到每个人只负责自己的那块代码,不需要去改别人的代码
 2. 在工程层面,尽量减少使用公共文件,尽量每个文件只由一个人负责
 3. 在git层面,如果有必要可以单独建一个分支,用于更新某些公共文件,并及时的更新到其他分支

 ## 6. 其他分支
  有一些常用的分支,可能我们会用到
  - bug分支:用于紧急修复产品环境的bug

## 7. 根据情况调整,简化流程
 上面的图例只有测试服务器和产品服务器,更多人服务器类型的工作流程是类似的,图例也只有man1和man2两个个人分支,更多个人分支的工作流程也是类似的

 上面的图例主要用于以下特点的项目(需要把整个项目打包成一个整体)
 - 单页面web前端应用,整个项目只有一个html文件,页面之间的切换由本地路由控制,每次更新到服务器都需要打包所有页面
 - Java,Go等后端应用,每次都需要打包成一个整体,可能是一个文件,或者是一批文件
 - 使用持续集成构建的方式更新代码到服务器

 这样主要是避免了一些问题
 - 线上新代码被旧代码需要覆盖:多人同时开发项目,都需要更新到测试服务器,如果不是统一push到test分支做持续集成构建,很难保证上线新代码不会被旧代码覆盖
 - 未测试的代码被更新到产品环境:这个问题也需要注意,因为这个问题并不能从流程上完全杜绝,需要各位在开发中留意

 对于像下面这种特点的项目,可以根据情况调整,简化流程:
 - 多页面web前端应用,把某一个页面更新到服务器并不影响其他页面
 - NodeJs,PHP,Python等后端应用,只上传自己更新的文件,而不影响服务器上其他文件(把所有代码打包成一个整体的方式除外)
 - 使用本地构建的方式更新代码到服务器

 比如:
 - master:主分支
 - man1:个人man1分支
 - man2:个人man2分支
 - task1:需求task1分支
 - task2:需求task2分支

 使用流程
 ![](https://image-static.segmentfault.com/385/082/3850821150-5c666cc4771bf)

 如果多个需求没有冲突,可以同时在man1个人分支上开发,并根据需要上传到不同的服务器

 如果多个需求有冲突,可以每个需求都新好幸福刚看完人一个分支,如上图所示
 1. 提交到代码到本地task1分支(以task1个人为例)
 2. 根据需要上传到不同的服务器
 3. 如果代码通过产品环境后,更新到每个个人分支,并删除task1分支